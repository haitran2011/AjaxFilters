@model RatingFilterModelSpikes

@inject NopAjaxFiltersSettings nopAjaxFiltersSettings

@{
    Html.AddScriptParts(ResourceLocation.Footer, "~/Plugins/Spikes.Nop.Plugins.AjaxFilters/Scripts/RatingFilter.min.js");

    string toggleStateClass = "toggleControl";
    string toggleStateStyles = string.Empty;

    if (nopAjaxFiltersSettings.CloseVendorsFilterBox)
    {
        toggleStateClass = "toggleControl closed";
        toggleStateStyles = "display: none;";
    }

    string filtersPanelClass = nopAjaxFiltersSettings.FiltersUIMode == FiltersUIMode.UseCheckboxes ? "filtersCheckboxPanel" : "filtersDropDownPanel";
}

@functions {
    string GetOptionAttributes(FilterItemState state)
    {
        string optionAttributes = string.Empty;

        if (state == FilterItemState.Checked || state == FilterItemState.CheckedDisabled)
        {
            if (nopAjaxFiltersSettings.FiltersUIMode == FiltersUIMode.UseCheckboxes)
            {
                optionAttributes += "checked=\"checked\"";
            }
            else
            {
                optionAttributes += "selected=\"selected\"";
            }
        }

        if (state == FilterItemState.Disabled || state == FilterItemState.CheckedDisabled)
        {
            optionAttributes += " disabled=\"disabled\"";
        }

        return optionAttributes;
    }

    IHtmlContent GetListOfOptions(IList<RatingFilterItem> ratingFilterItems, FiltersUIMode uiMode)
    {
        HtmlContentBuilder result = new HtmlContentBuilder();

        foreach (var filterItem in ratingFilterItems)
        {
            string optionAttributes = GetOptionAttributes(filterItem.FilterItemState);
            string inputId = string.Format("rating-input-{0}", filterItem.Id);

            if (uiMode == FiltersUIMode.UseCheckboxes)
            {
                var ratingPercent = 0;
                if (filterItem.Id != 0)
                {
                    ratingPercent = (filterItem.Id * 100) / 5;
                }

                result.AppendHtml("<li class=\"checkbox-item\">");
                result.AppendHtml($"<input {optionAttributes} data-option-ids=\"{filterItem.Id}\" type=\"checkbox\" id=\"{inputId}\" />");
                result.AppendHtml($"<label class=\"filter-item-name product-rating-box\" for=\"{inputId}\"><div class=\"rating\"><div style=\"width: {ratingPercent}%\"></div></div><span class=\"filter-item-count\" for=\"{inputId}\">({filterItem.FilterCount})</label>");
                
                
                result.AppendHtml("</li>");

            }
            else
            {
                result.AppendHtml($"<option @optionAttributes data-option-ids=\"{filterItem.Id}\" value=\"{filterItem.Name}\">{filterItem.Name}<span class=\"filter-item-count\" for=\"{inputId}\">({filterItem.FilterCount})</option>");
            }
        }

        return result;
    }
}

<div class="block filter-block ratingFilterPanelSpikes">
    <div class="title">
        <a class="@toggleStateClass">Rating</a>
        <a class="clearFilterOptions">@T("Spikes.NopAjaxFilters.Client.Common.Clear")</a>
    </div>
    <div class="filtersGroupPanel @filtersPanelClass" style="@toggleStateStyles">
        @if (nopAjaxFiltersSettings.FiltersUIMode == FiltersUIMode.UseCheckboxes)
        {
            <ul class="checkbox-list">
                @GetListOfOptions(Model.RatingFilterItems, nopAjaxFiltersSettings.FiltersUIMode)
            </ul>
        }
        else
        {
            <select class="attribute-options-select" id="ratingFiltersDropDown">
                <option value="0">@T("Spikes.NopAjaxFilters.Client.Common.All")</option>
                @GetListOfOptions(Model.RatingFilterItems, nopAjaxFiltersSettings.FiltersUIMode)
            </select>
        }
    </div>
</div>